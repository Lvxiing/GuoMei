/**
 * gome
 * created by 虚拟前端组 on 2017-02-16
 */
var root=window||{},util=root.util;root.API_PATH_v1=this.BASE_PATH+"common/v1/api/";var loginUrl="//login.gome.com.cn/login.no",wrapEl,Recharge=function(a){this.options=$.extend({element:"",defSelectNum:0,bid:0,loginName:"",curSelCid:"",disabledVal:"1248M",telMsg:{defmsg1:"支持移动/联通/电信/极信",flowdefmsg:"支持移动/联通/电信",defmsg2:"请输入手机号码",errmsg1:"未知地区运营商",errmsg2:"请填写正确的手机号"},tareaMsg:"请输入你想对TA说的话（充值成功后会短信发至充值手机），最多30个字哦",urlData:{regrng:1,pn:0,bid:0,cnname:"",cid:0,sid:0,sp:0,pamt:0},confirmUrl:"confirminformation.html",couponUrl:"//wt.gome.com.cn/recharge/activatecoupon.html"},a||{}),wrapEl=this.options.element,this.init()};$.extend(Recharge.prototype,{init:function(){$("#txmobile").val(this.options.telMsg.defmsg2),this.getSliderAd(),this.getRecommendAd(),this.getIndexData(!0),this.onEvent()},getSliderAd:function(){var a=this,b=$(".slider-main"),c=$(".slider-cont",b),d=Number(c.attr("slideradid"));d&&$.ajax({url:root.ADAPI_PATH,type:"get",data:{boxid:d},success:function(d){if(200===d.code){var e=d.data,f=a.renderSliderAd(e);c.html("<ul>"+f.adStr+"</ul>"),$(".slider-nav",b).html(f.navStr),$(".slider-nav a:first",b).addClass("active"),a.scrollAd($(".slider-main"))}}})},renderSliderAd:function(a){var b=a.grps||[],c={adStr:"",navStr:""};return $.each(b,function(a,b){var d=b.type,e=b.ads||[];switch(d){case 2:$.each(e,function(b,d){var e=d.furl||"",f=d.rurl||"",g=e?'target="_blank"':"";e=e||"javascript:;",c.adStr+='<li style="background:url('+f+') no-repeat center top;"><a href="'+e+'" '+g+"></a></li>",c.navStr+='<a href="javascript:;">'+(a+1)+"</a>"})}}),c},scrollAd:function(a){function b(){c()}function c(){g-1>l?l++:l=0,f.hide().eq(l).fadeIn(300),h.removeClass("active").eq(l).addClass("active")}function d(){l>0?l--:l=g-1,f.hide().eq(l).fadeIn(300),h.removeClass("active").eq(l).addClass("active")}function e(a){l=a,f.hide().eq(a).fadeIn(300),h.removeClass("active").eq(a).addClass("active")}var f=$(".slider-cont li",a),g=f.length,h=$(".slider-nav a"),i=$(".full-slider-page .full-slider-prev"),j=$(".full-slider-page .full-slider-next"),k=null,l=0;k=setInterval(b,3e3),h.on("mouseenter",function(){clearInterval(k),e($(this).index())}).on("mouseleave",function(){k=setInterval(b,3e3)}),f.on("mouseenter",function(){clearInterval(k)}).on("mouseleave",function(){k=setInterval(b,3e3)}),j.on("click",function(){clearInterval(k),c()}),i.on("click",function(){clearInterval(k),d()}),j.on("mouseenter",function(){clearInterval(k)}),i.on("mouseenter",function(){clearInterval(k)})},getRecommendAd:function(){var a=this,b=$(".recm-slider-main "),c=Number(b.attr("rmsliderid"));c&&$.ajax({url:root.ADAPI_PATH,type:"get",data:{boxid:c},success:function(c){if(200===c.code){var d=c.data,e=a.renderRecommendAd(d);b.html(e).css({width:978*(d.grps.length+2)+"px",left:"-978px"})}}})},renderRecommendAd:function(a){var b=a.grps||[],c=[],d=a.vw,e=a.vh,f="",g="";return $.each(b,function(a,h){var i=h.type,j=h.ads||[],k="",l="";switch(i){case 2:$.each(j,function(a,b){var c=b.furl||"",f=b.rurl||"",g=c?'target="_blank"':"";c=c||"javascript:;",k+='<div class="fore1"><a href="'+c+'"  '+g+' style="display:block;"><img alt="充值" src="'+f+'" style="width:'+d+"px;height:"+e+'px"></a></div>'}),l='<li class="pane'+(a+1)+'">'+k+"</li>",0==a?f=l:a==b.length-1&&(g=l),c.push(l)}}),c.unshift(g),c.push(f),c.join("")},scrollRecommendAd:function(a){function b(){c()}function c(){f-2>k?k++:(k=f-4,e.css({left:"0px"})),k=0==k?1:k,e.stop(!0).animate({left:-k*g+"px"},1e3)}function d(){k>1?k--:(k=f-2,e.css({left:-g*(f-1)+"px"})),e.stop(!0).animate({left:-k*g+"px"},1e3)}var e=$(".recm-slider-main"),f=$("li",e).length,g=978,h=$(".recm-slider-page .slider-prev"),i=$(".recm-slider-page .slider-next"),j=null,k=1;j=setInterval(b,3e7),i.on("click",function(){clearInterval(j),c()}),h.on("click",function(){clearInterval(j),d()}),e.on("mouseenter",function(){clearInterval(j)}).on("mouseleave",function(){j=setInterval(b,3e3)})},getIndexData:function(a){var b=this,c=b.options.disabledVal,d=$(".mobilesell:visible #mobilesell",wrapEl),e=$(".tab-btn",wrapEl).eq(0).hasClass("cur")?501:601,f=0;util.api({url:"presale",data:{rt:e},type:"get",success:function(e){if(200===e.rpco){a&&$("#txmobile").val(b.options.telMsg.defmsg2);var g=e.body||{},h=g.grps||[],i=g.ulrph||[],j="";$.each(h,function(a,b){var d=b.cid,e=b.cnname,g=b.pri||"";("100元"==e||"1G"==e)&&(f=a),e!=c&&(j+='<li price="'+d+'" data-dtpi="'+g+'" >'+e+"<em></em></li>")}),$("#indexpackage-warp:visible",wrapEl).html("<ul>"+j+"</ul>").find("li:eq("+f+")").addClass("pv-item-active"),d.html("¥ "+h[f].pri),i.length>0&&$(".tel-num-big",wrapEl).attr({"data-hisNum":!0,historyNumArr:i})}}})},mobileValidate:function(){var a=this,b=$("#txmobile:visible",wrapEl),c=b.siblings(".tel-msg-tip"),d=b.siblings(".tel-num-big"),e=(b.siblings(".history-telnum"),[]),f=$(".tab-btn",wrapEl).eq(0).hasClass("cur")?501:601;b.addClass("tel-num-sty").val($.trim(b.val()).replace(/[^\d]/g,""));var g=b.val(),h=g.length;g?(e=g.split(""),h>=3&&7>h&&e.splice(3,0,"-"),h>=7&&(e.splice(3,0,"-"),e.splice(8,0,"-")),d.show().html("<li>"+e.join("")+"</li>"),11==g.length&&(d.hide(),a.checkAsyncMobile(g,c),b.attr({isphonenum:!0}))):("true"!=d.attr("data-hisNum")&&d.text(""),d.hide(),c.show().text(501==f?a.options.telMsg.defmsg1:a.options.telMsg.flowdefmsg).removeClass("msg-color-blue"),b.removeClass("tel-num-sty"),util.setFocus(b,0),b.attr({isphonenum:!1,cansend:!1}),a.getIndexData())},checkAsyncMobile:function(a,b){var c=this,d=c.options.telMsg,e=c.options.defSelectNum,f=($(".mobilesell:visible #mobilesell",wrapEl),b.siblings("#txmobile")),g=(b.siblings(".history-telnum"),$(".tab-btn",wrapEl).eq(0).hasClass("cur")?501:601);util.api({url:"saleable",data:{rt:g,pn:a},type:"get",success:function(a){var h=a.rpco;if(40401===h&&b.text(d.errmsg1).show().addClass("msg-color-blue"),40402===h&&b.text(d.errmsg2).show().addClass("msg-color-blue"),200!==h)return c.getIndexData(),void f.attr({isphonenum:!1,cansend:!1});var i=a.body||{},j=i.grps||[],k=i.bid,l="",m=c.options.disabledVal;$.each(j,function(a,b){var c=b.cid,d=b.cnname,f=b.pri||"";d!=m&&(l+='<li price="'+c+'" data-dtpi="'+f+'" >'+d+"<em></em></li>",501==g?"100元"==d?e=a:parseInt(d)<100&&(e=a):601==g&&("1G"==d?e=a:parseInt(d)<=500&&1!=parseInt(d)&&(e=a)))}),$("#indexpackage-warp:visible",wrapEl).html("<ul>"+l+"</ul>").find("li:eq("+e+")").addClass("pv-item-active"),$("#txmobile:visible",wrapEl).attr("data-bid",k),b.text(i.rest+i.ropn).show().removeClass("msg-color-blue"),$("#indexpackage-warp .pv-item-active:visible",wrapEl).attr("autotrigger",!0).trigger("click"),c.options.bid=k,f.attr({isphonenum:!0})}})},getDtprice:function(a){var b=this,c=$(".tab-btn",wrapEl).eq(0).hasClass("cur")?501:601,d=$("#txmobile:visible",wrapEl),e=d.val(),f=d.attr("data-bid"),g=$(".mobilesell:visible #mobilesell",wrapEl),h=$("#tr-submit",wrapEl),i=b.options.curSelCid=a;util.api({url:"predeal",data:{rt:c,pn:e,bid:f||0,cid:a||0},type:"get",beforeSend:function(){g.html("正在查询价格...")},success:function(c){var f=c.rpco,j=c.body||{},k=j.sp;return 404==f?(g.text("暂无"),d.attr("cansend",!1),void h.addClass("submit-disabled")):b.options.curSelCid!=i?!1:void(200==f?($.extend(b.options.urlData,{pn:e,bid:j.bid,cid:a,cnname:j.cnname,sid:j.shopid,sp:j.sp,pamt:0}),g.attr("price",k),g.html("¥ "+(Number(k)/100).toFixed(2)),d.attr("cansend",!0),h.removeClass("submit-disabled")):g.text("查询失败！"))}})},submit:function(){var a,b=this,c=b.options.urlData,d=$("#txmobile:visible",wrapEl),e=d.attr("cansend"),f=d.attr("isphonenum");if("true"==e&&"true"==f){var g=$(".tab-btn",wrapEl).eq(0).hasClass("cur")?501:601,h=$("#indexpackage-warp .pv-item-active:visible",wrapEl);c.cid=h.attr("price"),c.sp=$("#mobilesell:visible",wrapEl).data("price"),c.cnname=h.text(),a=b.options.confirmUrl+"?"+util.encode("rt="+g+"/pn="+c.pn+"/bid="+c.bid+"/cid="+c.cid+"/sid="+c.sid+"/sp="+c.sp+"/fv="+c.cnname),b.isLogin()?root.location.href=a:window.open(loginUrl+"?orginURI="+window.location.protocol+"//wt.gome.com.cn/recharge/"+a,"_blank")}},isLogin:function(){var a=!1;return util.api({surl:API_PATH_v1+"checklogin",async:!1,type:"get",data:{t:(new Date).getTime()},success:function(b){a=b.rpco,200==a?($(".d-username",wrapEl).text(b.body.login),a=!0):a=!1}}),a},getMsgFun:function(){var a="选填"==$("#inpSendName",wrapEl).val()||""==$("#inpSendName",wrapEl).val()?"有人":$("#inpSendName",wrapEl).val(),b=$("#indexpackage-warp .pv-item-active:visible",wrapEl).children("span").text(),c=$("#txtarea",wrapEl).val()!=this.options.tareaMsg?$("#txtarea",wrapEl).val():"";msgCont=$(".preview-tip",wrapEl),msgCont.find("dd").text(a+"刚在国美在线为您充值"+b+"话费，并对您说："+c+"【国美在线】")},onEvent:function(){var a=this,b=a.options.telMsg.defmsg1,c=a.options.telMsg.defmsg2,d=a.options.telMsg.flowdefmsg,e=a.options.telMsg.errmsg2;a.options.tareaMsg;wrapEl.on("click",".r-coupon",function(){window.open(a.options.couponUrl,"_blank")}),wrapEl.on("click",".close-topad",function(){$(".topad").remove()});util.getLocationParams();wrapEl.on("click","#txmobile:visible",function(){var a=$(this);a.val()===c&&util.setFocus(a,0)}),wrapEl.on("focus","#txmobile:visible",function(){var a=$(this),e=a.siblings(".tel-num-big"),f=a.siblings(".tel-msg-tip"),g=(a.siblings(".history-telnum"),a.val()),h=$(".tab-btn",wrapEl).eq(0).hasClass("cur")?501:601;g===c||""===g?(a.val(""),"true"!=e.attr("data-hisnum")&&e.text(""),e.hide(),f.show().removeClass("msg-color-blue").text(501==h?b:d)):g.length<11?e.show():11==g.length&&e.show()}),wrapEl.on("blur","#txmobile:visible",function(){var a=$(this),b=a.siblings(".tel-num-big"),d=a.siblings(".tel-msg-tip"),f=(a.siblings(".history-telnum"),a.val());$(".tab-btn",wrapEl).eq(0).hasClass("cur")?501:601;b.hide(),f===c||""===f?(a.val(c),a.removeClass("tel-num-sty")):f.length<11&&d.text(e).show().addClass("msg-color-blue")}),wrapEl.on("paste","#txmobile:visible",function(a){var b=this;setTimeout(function(){$(b).keyup()},100)}),wrapEl.on("mouseup","#txmobile:visible",function(a){var b=$(this).val().replace(/[^0-9]/g,"");2==a.button&&""==b&&$(this).val("")}),wrapEl.on("keydown","#txmobile:visible",function(a){var b=$(this),d=b.val();d===c&&b.val(""),b.addClass("tel-num-sty")}),wrapEl.on("keyup","#txmobile:visible",function(){a.mobileValidate()}),wrapEl.on("click",".history-telnum:visible",function(){var a=$(this),b=a.siblings(".tel-num-big"),c=$(".tab-btn",wrapEl).eq(0).hasClass("cur")?501:601;if("true"==b.attr("data-hisnum")){var d=b.attr("historynumarr").split(","),e="";$.each(d,function(a,b){var c=b.toString().split("");c.splice(3,0,"-"),c.splice(8,0,"-"),e+="<li>"+c.join("")+"</li>"}),b.show().html(e)}var f=501==c?"手机充值":"流量充值",g=s_gi(s_account);g.linkTrackVars="prop26",g.prop26=f+":历史号码",g.tl(this,"o",f+":首页")}),wrapEl.on("click",".tel-num-big li:visible",function(){var c=$(this).text().replace(/[^\d]/g,""),e=$("#txmobile:visible",wrapEl);e.addClass("tel-num-sty").val(c);var f=$(".tab-btn",wrapEl).eq(0).hasClass("cur")?501:601;$(this).parent().hide(),11==c.length&&(e.siblings(".tel-msg-tip").removeClass("msg-color-blue").text(501==f?b:d),a.mobileValidate())}),wrapEl.on("click","#indexpackage-warp li:visible",function(){var b=$(this),c=$("#mobilesell:visible",wrapEl),d=$("#txmobile:visible",wrapEl);"true"==d.attr("isphonenum")?b.hasClass("pv-item-active")&&"true"!=b.attr("autotrigger")||(a.getDtprice(b.attr("price")),b.removeAttr("autotrigger")):c.text("¥ "+b.attr("data-dtpi")),$("#indexpackage-warp li:visible",wrapEl).removeClass("pv-item-active"),b.addClass("pv-item-active")}),wrapEl.on("click","#rms",function(){var a=$(this),b=a.parents(".rcg-items").find(".ta-pay-word");a.hasClass("cbox-active")?(a.removeClass("cbox-active"),b.hide()):(a.addClass("cbox-active"),b.show())}),$(document).on("click",function(a){var b=a.target,c=$(".select-list:visible",wrapEl),d=$(".tel-num-big:visible",wrapEl);(0==$(b).parents(".inpbox-pos").length||$(b).hasClass("tel-msg-tip"))&&d.hide(),c.hide(),"tmpl"==$(b).attr("id")&&(0!==c.length?c.hide():$(b).siblings(".select-list").show())}),wrapEl.on("click",".use-range-tab",function(){$(this).hasClass("disabled")||($(".use-range-tab",wrapEl).removeClass("cur"),$(this).addClass("cur"))}),wrapEl.on("click",".select-list li",function(){var b=$(this),c=$("#tmpl",wrapEl),d=$("#txtarea",wrapEl);b.parent().hide(),c.val(b.html().substring(0,3)),d.text(b.html()).val(b.html()),a.getMsgFun()}),wrapEl.on("click","#tr-submit",function(){var b=$("#txmobile:visible",wrapEl),d=b.val();d==c?(b.siblings(".tel-msg-tip").text(e).show().addClass("msg-color-blue"),b.val("")):a.submit()}),wrapEl.on("keydown","#txtarea",function(){return!1}),$("#inpSendName",wrapEl).on({focus:function(){var b=$(this);"选填"==b.val()&&b.val(""),a.getMsgFun()},blur:function(){var b=$(this);""===b.val()&&b.val("选填"),a.getMsgFun()},keyup:function(){a.getMsgFun()}});var f=1;wrapEl.on("click",".slider-prev",function(){var a=($(this),$(".recm-slider-main")),b=$("li",a).length,c=978;f>1?f--:(f=b-2,a.css({left:-c*(b-1)+"px"})),a.stop(!0).animate({left:-f*c+"px"},1e3)}),wrapEl.on("click",".slider-next",function(){var a=($(this),$(".recm-slider-main")),b=$("li",a).length,c=978;b-2>f?f++:(f=b-4,a.css({left:"0px"})),f=0==f?1:f,a.stop(!0).animate({left:-f*c+"px"},1e3)})}});